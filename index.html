<!DOCTYPE html>
<html>
<head>
  <title>Floating Cranes</title>
  <style>
    body {
      background: #e7faff;
      overflow: hidden;
      margin: 0;
      font-family: sans-serif;
      text-align: center;
    }

    #upload {
      margin-top: 20px;
    }

    .crane {
      position: absolute;
      width: 120px;
      cursor: grab;
      transition: transform 0.2s;
      pointer-events: auto;
    }

    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.8);
      pointer-events: none;
    }
  </style>
</head>
<body>

<h2>Upload Your Crane</h2>
<input type="file" id="upload" accept="image/*">

<div id="status"></div>

<script>
const WEBAPP_URL = "YOUR_WEBAPP_DEPLOYMENT_URL";

/* -----------------------
   Upload Image to Script
------------------------- */
document.getElementById("upload").addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onloadend = async function () {
        const base64Data = reader.result.split(",")[1];

        const form = new FormData();
        form.append("filename", file.name);
        form.append("data", base64Data);

        const res = await fetch(WEBAPP_URL, {
            method: "POST",
            body: form
        });

        const json = await res.json();
        document.getElementById("status").innerText = json.success ? 
            "Uploaded!" : "Upload failed.";
        
        loadCranes();
    };

    reader.readAsDataURL(file);
});

/* -----------------------
   Load All Cranes
------------------------- */
async function loadCranes() {
    const res = await fetch(WEBAPP_URL);
    const urls = await res.json();

    document.querySelectorAll(".crane").forEach(el => el.remove());

    urls.forEach(url => spawnCrane(url));
}

/* -----------------------
   Create Floating Crane
------------------------- */
function spawnCrane(url) {
    const img = document.createElement("img");
    img.src = url.replace("open?", "uc?"); // convert Drive link to direct
    img.className = "crane";

    img.style.left = Math.random()*window.innerWidth + "px";
    img.style.top = Math.random()*window.innerHeight + "px";

    document.body.appendChild(img);

    floatAround(img);
    makeDraggable(img);
}

/* -----------------------
   Gentle Floating Motion
------------------------- */
function floatAround(el) {
    let angle = Math.random() * 1000;

    function animate() {
        angle += 0.01;

        const dx = Math.sin(angle) * 0.5;
        const dy = Math.cos(angle) * 0.5;

        el.style.transform = `translate(${dx}px, ${dy}px)`;

        requestAnimationFrame(animate);
    }
    animate();
}

/* -----------------------
   Draggable + Sparkles
------------------------- */
function makeDraggable(el) {
    let dragging = false;

    el.addEventListener("mousedown", () => dragging = true);
    document.addEventListener("mouseup", () => dragging = false);

    document.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        el.style.left = e.clientX - 40 + "px";
        el.style.top = e.clientY - 40 + "px";
        sparkle(e.clientX, e.clientY);
    });
}

/* -----------------------
   Sparkle Trail
------------------------- */
function sparkle(x, y) {
    const s = document.createElement("div");
    s.className = "sparkle";
    s.style.left = x + "px";
    s.style.top = y + "px";
    document.body.appendChild(s);

    setTimeout(() => s.remove(), 300);
}

/* Start */
loadCranes();
</script>
</body>
</html>
